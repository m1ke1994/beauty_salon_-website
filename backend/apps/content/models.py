from django.db import models


class Page(models.Model):
    title = models.CharField("????????", max_length=200)
    slug = models.SlugField("????", max_length=200, unique=True)
    description = models.TextField("????????", blank=True)
    order = models.PositiveIntegerField("???????", default=0)
    is_active = models.BooleanField("???????", default=True)

    class Meta:
        ordering = ["order", "title"]
        verbose_name = "????????"
        verbose_name_plural = "????????"

    def __str__(self) -> str:
        return self.title


class Section(models.Model):
    page = models.ForeignKey(Page, on_delete=models.CASCADE, related_name="sections")
    title = models.CharField("?????????", max_length=200)
    subtitle = models.CharField("????????????", max_length=200, blank=True)
    description = models.TextField("????????", blank=True)
    slug = models.SlugField("????/?????", max_length=200)
    order = models.PositiveIntegerField("???????", default=0)
    extra = models.JSONField("?????????????? ??????", default=dict, blank=True)

    class Meta:
        ordering = ["order", "title"]
        verbose_name = "??????"
        verbose_name_plural = "??????"
        unique_together = ("page", "slug")

    def __str__(self) -> str:
        return f"{self.page.title}: {self.title}"


class SectionItem(models.Model):
    section = models.ForeignKey(Section, on_delete=models.CASCADE, related_name="items")
    title = models.CharField("?????????", max_length=200, blank=True)
    subtitle = models.CharField("????????????", max_length=200, blank=True)
    text = models.TextField("?????", blank=True)
    image_url = models.CharField("????????/URL", max_length=500, blank=True)
    icon = models.CharField("??????", max_length=100, blank=True)
    button_text = models.CharField("????? ??????", max_length=200, blank=True)
    button_url = models.CharField("?????? ??????", max_length=500, blank=True)
    order = models.PositiveIntegerField("???????", default=0)
    meta = models.JSONField("??????????", default=dict, blank=True)

    class Meta:
        ordering = ["order", "title"]
        verbose_name = "????????/???????"
        verbose_name_plural = "????????/????????"

    def __str__(self) -> str:
        return self.title or f"??????? #{self.pk}"


class Review(models.Model):
    name = models.CharField("???", max_length=120)
    avatar_url = models.CharField("?????? (URL)", max_length=500, blank=True)
    rating = models.PositiveIntegerField("??????", default=5)
    text = models.TextField("????? ??????")
    service = models.CharField("??????", max_length=200, blank=True)
    date = models.CharField("????", max_length=100, blank=True)
    order = models.PositiveIntegerField("???????", default=0)

    class Meta:
        ordering = ["order", "name"]
        verbose_name = "?????"
        verbose_name_plural = "??????"

    def __str__(self) -> str:
        return self.name


class PriceCategory(models.Model):
    title = models.CharField("?????????", max_length=200)
    order = models.PositiveIntegerField("???????", default=0)

    class Meta:
        ordering = ["order", "title"]
        verbose_name = "????????? ??????"
        verbose_name_plural = "????????? ??????"

    def __str__(self) -> str:
        return self.title


class PriceItem(models.Model):
    category = models.ForeignKey(PriceCategory, on_delete=models.CASCADE, related_name="items")
    name = models.CharField("????????", max_length=200)
    price = models.CharField("????", max_length=100)
    duration = models.CharField("????????????", max_length=100, blank=True)
    is_popular = models.BooleanField("???", default=False)
    order = models.PositiveIntegerField("???????", default=0)

    class Meta:
        ordering = ["order", "name"]
        verbose_name = "??????? ??????"
        verbose_name_plural = "??????? ??????"

    def __str__(self) -> str:
        return self.name


class PortfolioItem(models.Model):
    category = models.CharField("?????????", max_length=100)
    title = models.CharField("????????", max_length=200)
    image_url = models.CharField("???????? (URL)", max_length=500)
    order = models.PositiveIntegerField("???????", default=0)

    class Meta:
        ordering = ["order", "title"]
        verbose_name = "?????? ?????????"
        verbose_name_plural = "?????????"

    def __str__(self) -> str:
        return self.title
