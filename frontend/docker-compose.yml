services:
  frontend:
    image: node:20-bookworm-slim
    working_dir: /app
    ports:
      - "5173:5173"

    volumes:
      - ./:/app
      - frontend_node_modules:/app/node_modules

    environment:
      CHOKIDAR_USEPOLLING: "true"
      WATCHPACK_POLLING: "true"
      NPM_CONFIG_AUDIT: "false"
      NPM_CONFIG_FUND: "false"
      NODE_ENV: "development"

    command: >
      sh -lc "
        if [ -f package-lock.json ]; then
          test -x node_modules/.bin/vite || npm ci;
        else
          test -x node_modules/.bin/vite || npm install;
        fi &&
        npm run dev -- --host 0.0.0.0 --port 5173
      "

volumes:
  frontend_node_modules:
